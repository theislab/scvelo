name: CI

# trigger
on: [push]

jobs:
 base:
   runs-on: ubuntu-latest
   strategy:
     matrix:
       python-version: [3.8]

   steps:
   - name: Check out repository
     uses: actions/checkout@v2

   - name: Prepare python ${{ matrix.python-version }}
     uses: actions/setup-python@v1
     with:
       python-version: ${{ matrix.python-version }}

   - name: Cache
     uses: actions/cache@v1
     with:
       path: ~/.cache
       key: ${{ runner.os }}-ci-base

   - name: Install dependencies
     run: |
      pip install wheel docutils black pytest
      pip install -e .
  
   - name: Lint
     run: black --check .

   - name: Unit tests
     run: pytest

   - name: rst2html
     run: rst2html.py --halt=2 README.rst >/dev/null

