name: CI

# trigger
on: [push]

# environment variables
env:
  MPLBACKEND: AGG

# jobs to execute
jobs:
 # basic tests
 base:
   runs-on: ubuntu-latest
   strategy:
     matrix:
       python-version: [3.8, 3.7]

   steps:
   - name: Check out repository
     uses: actions/checkout@v2

   - name: Prepare python ${{ matrix.python-version }}
     uses: actions/setup-python@v1
     with:
       python-version: ${{ matrix.python-version }}

   - name: Cache
     uses: actions/cache@v1
     with:
       path: ~/.cache
       key: ${{ runner.os }}-ci-base

   - name: Install dependencies
     run: |
      pip install wheel
      pip install docutils black pytest pytest-cov
      pip install -e .
  
   - name: Lint
     run: black --check .

   - name: Unit tests
     run: python -m pytest --cov=scvelo --cov-report=xml

   - name: Coverage
     uses: codecov/codecov-action@v1
     with:
       token: ${{ secrets.CODECOV_TOKEN }}
       file: ./coverage.xml

   - name: rst2html
     run: rst2html.py --halt=2 README.rst >/dev/null

